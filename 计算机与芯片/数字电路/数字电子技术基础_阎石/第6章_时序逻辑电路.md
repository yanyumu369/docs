##### 内容提要

本章系统讲授**时序逻辑电路**的工作原理和分析方法、设计方法。

首先，概要地讲述了时序逻辑电路在逻辑功能和电路结构上的特点，并详细介绍了分析时序逻辑电路的具体方法和步骤。然后分别介绍了**移位寄存器**、**计数器**、**顺序脉冲发生器**等各类常用时序逻辑电路的工作原理和使用方法。在讲述了时序逻辑电路的设计方法后，初步介绍如何用硬件描述语言描述时序电路。最后从物理概念上讨论了**时序逻辑电路的动态特性**和**竞争-冒险现象**。

## 6.1 概述

在第四章所讨论的组合逻辑电路中，任一时刻的输出信号仅取决于当时的输入信号。这也是组合逻辑电路在逻辑功能上的共同特点。本章要介绍另一种类型的逻辑电路，**在这类逻辑电路中，任一时刻的输出信号不仅取决于当时的输入信号，而且还取决于电路原来的状态，或者说，还与以前的输入有关**。具备这种逻辑功能特点的电路称为**时序逻辑电路**（sequential logic circuit，简称时序电路），以区别于组合逻辑电路。

为了进一步说明时序逻辑电路的特点，下面来分析一下图 6.1.1 给出的一个实例—**串行加法器电路**。

**所谓串行加法，是指在将两个多位数相加时，采取从低位到高位逐位相加的方式完成相加运算**。由于每一位（例如第 $i$ 位）相加的结果不仅取决于本位的两个加数 $a_i$ 和 $b_i$，还与低一位是否有进位有关，所以完整的串行加法器电路除了应该具有将两个加数和来自低位的进位相加的能力之外，还必须具备记忆功能，这样才能把本位相加后的进位结果保存下来，以备做高一位的加法时使用。因此，图 6.1.1 所示的串行加法器电路包含了两个组成部分，一部分是**全加器 Σ**，另部分是**由触发器构成的存储电路**。前者执行 $a_i$、$b_i$ 和 $c_{i-1}$ 三个数的相加运算，后者负责记下每次相加后的进位结果。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.1.1_串行加法器电路.png"/><br>
</div>

通过这个简单的例子不难看出，时序电路在电路结构上有两个显著的特点。

- 第一，时序电路通常包含**组合电路**和**存储电路**两个组成部分，而**存储电路**是必不可少的。
- 第二，**存储电路的输出状态必须反馈到组合电路的输入端，与输入信号一起，共同决定组合逻辑电路的输出**。

时序电路的框图可以画成图 6.1.2 所示的普遍形式。图中的 $X(x_1, x_2, …, x_i)$ 代表**输入信号**，$Y(y_1, y_2, …, y_i)$ 代表**输出信号**，$Z(z_1, z_2, …, z_i)$ 代表**存储电路的输入信号**，$Q(q_1, q_2, …, q_i)$ 代表**存储电路的输出**。这些信号之间的逻辑关系可以用三个方程组来描述

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\公式6.1.1.png"/><br>
</div>

式（6.1.1）称为输出方程，式（6.1.2）称为驱动方程（或激励方程），式（6.1.3）称为状态方程。$q_1$, $q_2$, …, $q_l$ 表示存储电路中每个触发器的现态，$q_1^*$, $q_2^*$, …, $q_l^*$ 表示存储电路中每个触发器的次态。如果将式（6.1.1）、（6.1.2）和（6.1.3）写成向量函数的形式，则得到
$$\begin{align} &Y=F[X, Q]\\\ &Z=G[X, Q]\\\ &Q^*=H[Z, Q] \end{align}$$

由于存储电路中触发器的动作特点不同，在时序电路中又有**同步时序电路**和**异步时序电路**之分。**在同步时序电路中，所有触发器状态的变化都是在同一时钟信号操作下同时发生的**。而**在异步时序电路中，触发器状态的变化不是同时发生的**。

此外，有时还根据输出信号的特点将时序电路划分为**米利（Mealy）型**和**穆尔（Moore）型**两种。**在米利型电路中，输出信号不仅取决于存储电路的状态，而且还取决于输入变量**；**在穆尔型电路中，输出信号仅仅取决于存储电路的状态**。可见，穆尔型电路只不过是米利型电路的一种特例而已。

以后还会看到，在有些具体的时序电路中，并不都具备图 6.1.2 所示的完整形式。例如，有的时序电路中没有组合电路部分，而有的时序电路又可能没有输人逻辑变量，但它们在逻辑功能上仍具有时序电路的基本特征。

鉴于**时序电路在工作时是在电路的有限个状态间按一定的规律转换的**，所以又将时序电路称为**状态机**（State Machine，简称 SM）、**有限状态机**（Finite State Machine，简称 FSM）或**算法状态机**（Algorithmic State Machine，简称 ASM）。

在分析时序电路时只要将状态变量和输入信号一样当作逻辑函数的输入变量处理，那么分析组合电路的一些运算方法仍然可以使用。不过，由于任意时刻状态变量的取值都和电路的历史情况有关，所以分析起来要比组合电路复杂一些。为便于描述存储电路的状态及其转换规律，还要引入一些新的表示方法和分析方法。

至于时序电路的设计方法，则更复杂一些，在讲过若干典型的时序电路之后对此再做详细介绍。

## 6.2 时序逻辑电路的分析方法

### 6.2.1 同步时序逻辑电路的分析方法

分析一个时序电路，就是要**找出给定时序电路的逻辑功能**。具体地说，就是要求**找出电路的状态和输出的状态在输入变量和时钟信号作用下的变化规律**。

首先讨论**同步时序电路**的分析方法。由于同步时序电路中所有触发器都是在同一个时钟信号操作下工作的，所以分析方法比较简单。

在本章 6.1 节中已经讲过，时序电路的逻辑功能可以用**输出方程**、**驱动方程**和**状态方程**全面描述。因此，只要能写出给定逻辑电路的这三个方程，那么它的逻辑功能也就表示清楚了。根据这三个方程，就能够求得**在任何给定输人变量状态和电路状态下电路的输出和次态**。

分析同步时序电路时一般按如下步骤进行：

1. 从给定的逻辑图中写出每个触发器的**驱动方程**（亦即存储电路中每个触发器输入信号的逻辑函数式）。
2. 将得到的这些驱动方程代人相应触发器的**特性方程**，得出每个触发器的**状态方程**，从而得到由这些状态方程组成的整个时序电路的状态方程组。
3. 根据逻辑图写出电路的**输出方程**。

【例 6.2.1】试分析图 6.2.1 所示时序逻辑电路的逻辑功能，写出它的驱动方程、状态方程和输出方程。FF<sub>1</sub>、FF<sub>2</sub> 和 FF<sub>3</sub> 是三个主从结构的 TTL 触发器，下降沿动作，**输入端悬空时和逻辑 1 状态等效**。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.1_时序逻辑电路.png"/><br>
</div>

1. 从图 6.2.1 给定的逻辑图可写出电路的驱动方程为
   $$\begin{array}{ll} J_1=(Q_2\cdot Q_3)' &K_1=1\\\ J_2=Q_1 &K_2=(Q_1'\cdot Q_3')'\\\ J_3=Q_1\cdot Q_2 &K_3=Q_2 \end{array} \tag{6.2.1}$$
2. 将式（6.2.1）代入 JK 触发器的特性方程 $Q^*=JQ'+K'Q$ 中去，于是得到电路的状态方程
   $$\begin{align} &Q_1^*=(Q_2\cdot Q_3)'Q_1'\\\ &Q_2^*=Q_1\cdot Q_2'+Q_1'\cdot Q_3'\cdot Q_2\\\ &Q_3^*=Q_1\cdot Q_2\cdot Q_3'+Q_2'\cdot Q_3\end{align} \tag{6.2.2}$$
3. 根据逻辑图写出输出方程为
   $$Y=Q_2\cdot Q_3 \tag{6.2.3}$$

### 6.2.2 时序逻辑电路的状态转换表、状态转换图、状态机流程图和时序图

从理论上讲，有了驱动方程、状态方程和输出方程以后，时序电路的逻辑功能就已经描述清楚了。然而通过例 6.2.1 可以发现，从这一组方程式中还不能获得电路逻辑功能的完整印象。这主要是由于电路每一时刻的状态都和电路的历史情况有关的缘故。由此可以想到，如果将电路在一系列时钟信号作用下状态转换的全部过程找出来，则电路的逻辑功能便可一目了然了。

用于描述时序电路状态转换全部过程的方法有**状态转换表**（也称**状态转换真值表**）、**状态转换图**、**状态机流程图**和**时序图**。由于这几种方法和方程组一样，都可以用来描述同一个时序电路的逻辑功能，所以它们之间可以互相转换。此外，还可以用硬件描述语言对时序电路的逻辑功能进行描述，这一部分内容将在后面的有关章节中介绍。

#### 一、状态转换表

若将任何一组输入变量及电路初态的取值代入状态方程和输出方程，即可算出电路的次态和现态下的输出值：以得到的次态作为新的初态，和这时的输入变量取值一起再代人状态方程和输出方程进行计算，又得到一组新的次态和输出值。如此继续下去，将全部的计算结果列成真值表的形式，就得到了状态转换表。

【例 6.2.2】试列出图 6.2.1 所示电路的状态转换表。

由图 6.2.1 可见，这个电路没有输入逻辑变量。（需要注意的是，不要把 CLK 当作输入逻辑变量。时钟信号只是控制触发器状态转换的操作信号。）因此，电路的次态和输出只取决于电路的初态，它属于**穆尔型时序电路**。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\表6.2.1_状态转换表.png"/><br>
</div>

最后还要检查一下得到的状态转换表是否包含了电路所有可能出现的状态。结果发现，$Q_3Q_2Q_1$ 的状态组合共有 8 种，而根据上述计算过程列出的状态转换表中只有 7 种状态，缺少 $Q_3Q_2Q_1=111$ 这个状态。将这个计算结果补充到表中以后，才得到完整的状态转换表。

有时也将电路的状态转换表列成表 6.2.2 的形式。这种状态转换表给出了在一系列始终信号作用下电路状态转换的顺序，比较直观。

从表 6.2.2 上很容易看出，每经过 7 个时钟信号以后电路的状态循环变化一次，所以这个电路具有对时钟信号计数的功能。同时，因为每经过 7 个时钟脉冲作用以后输出端 $Y$ 输出一个脉冲（由 0 变 1，再由 1 变 0），所以这是一个**七进制计数器**，$Y$ 端的输出就是进位脉冲。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\表6.2.2_电路状态转换表的另一种形式.png"/><br>
</div>

#### 二、状态转换图

为了以更加形象的方式直观地显示出时序电路的逻辑功能，有时还进一步将状态转换表的内容表示成状态转换图的形式。

图 6.2.2 是图 6.2.1 所示电路的**状态转换图**。**在状态转换图中以圆圈表示电路的各个状态，以箭头表示状态转换的方向**。同时，**还在箭头旁注明了状态转换前的输入变量取值和输出值。通常将输入变量取值写在斜线以上，将输出值写在斜线以下**。因为图 6.2.1 电路没有输入逻辑变量，所以斜线上方没有注字。

<div align=center>
<img width=50% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.2_状态转换图.png"/><br>
</div>

【例 6.2.3】分析图 6.2.3 所示时序逻辑电路的逻辑功能，写出电路的驱动方程、状态方程和输出方程，画出电路的状态转换图。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.3_时序逻辑电路.png"/><br>
</div>

首先从给定的电路图写出驱动方程
$$\begin{align} &D_1=Q_1'\\\ &Q_2=A\oplus Q_1\oplus Q_2 \end{align} \tag{6.2.4}$$

将式（6.2.4）代入 D 触发器的特性方程，得到电路的状态方程
$$\begin{align} &Q_1^*=D_1=Q_1'\\\ &Q_2^*=D_2=A\oplus Q_1\oplus Q_2 \end{align} \tag{6.2.5}$$

从图 6.2.3 所示的电路图写出输出方程
$$\begin{align} Y&=((A'Q_1Q_2)'\cdot(AQ_1'Q_2')')'\\\ &=A'Q_1Q_2+AQ_1'Q_2' \end{align} \tag{6.2.6}$$

为便于画出电路的状态转换图，可先列出电路的状态转换表，如表 6.2.3 所示。它以真值表的形式表示了电路的次态和输出（$Q_2^*Q_1^*/Y$）与现态和输入变量（$Q_2Q_1$ 和 $A$）之间的函数关系。表中的数值用式（6.2.5）和式（6.2.6）计算得到。

根据表 6.2.3 画出的电路状态转换图如图 6.2.4 所示。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.4_状态转换图.png"/><br>
</div>

由图 6.2.4 所示的状态转换图可以看出，图 6.2.3 所示电路可以作为可控计数器使用。当 $A=0$ 时是一个加法计数器，在时钟信号连续作用下，$Q_2Q_1$ 的数值从 00 到 11 递增。如果从 $Q_2Q_1=00$ 状态开始加入时钟信号，则 $Q_2Q_1$ 的数值可以表示输入的时钟脉冲数目。当 $A=1$ 时是一个减法计数器，在连续加入时钟脉冲时，$Q_2Q_1$ 的数值是从 11 到 00 递减的。

#### 三、状态机流程图（SM 图）

时序电路（也称状态机）逻辑功能的另外一种描述形式称为**状态机流程图**（State Machine Flowchart，或 State Machine Chart），简称 **SM 图**。也有把它称为 ASM 图的。

SM 图采用类似于编写计算机程序时使用的**程序流程图**的形式，表示在一系列时钟脉冲作用下时序电路状态转换的流程以及每个状态下的输入和输出。因此，可以理解为它是状态转换图按时钟信号顺序展开的一种形式，能够更加直观地表示出时序电路的运行过程。

SM 图中使用的图形符号有三种：**状态框**、**判断框**和**条件输出框**。状态框是一个矩形框，如图 6.2.5（a）所示。每个状态框表示电路的一个状态，**左上角注明状态的名称**（也有将状态名称写在框内的），**右上角注明状态编码**，**框内列出此状态下等于 1 的输出逻辑变量**。因为写在状态框内的输出只与电路的状态有关，所以一定是 **Moore 型输出**。当这个状态机用作复杂系统的控制电路时，每个输出信号可能就是系统进行某种操作的控制指令，所以有时也在框内直接注明系统所应当执行的操作，代替输出信号。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.5_SM图中使用的三种图形符号.png"/><br>
</div>

**判断框**又称**条件分支框**，它的外形为**菱形**，如图 6.2.5（b）所示。判断框接在状态框的出口，决定着状态转换的去向。框内标注的是判断条件，它可以是一个逻辑变量、一个乘积项或者一个逻辑式。**根据判断条件的取值是 1 还是 0，确定在时钟信号到达时电路状态的去向**。

**条件输出框**的外形为**扁圆形**，如图 6.2.5（c）所示。它接在判断框的出口，框内标注输出变量的名称。当所接判断框出口的条件满足时，框内输出变量等于 1，否则等于 0。

**一个时序电路的 SM 图由若干个 SM 模块组成。每个模块包含一个状态框、若干个判断框和条件输出框**。图 6.2.6 就是一个 SM 模块的例子。当电路进人 $S_1$ 状态后，输出 $Y_1$、$Y_2$ 等于 1。若这时 $A=1$、$B=0$，则输出 $Y_4$ 也等于 1，下一个时钟信号到达时，电路转向出口 2 所指向的次态。若这时 A=B=1,则 Y,=0,下一个时钟信号到达时，电路转向出口 3 所指向的次态。若这时 $A=0$，则 $Y_3$ 等于 1，$Y_4$ 等于 0，下一个时钟信号到达时，电路转向出口 1 所指向的次态。可见，一个 SM 模块所表示的内容相当于状态转换图中一个状态所表示的内容。

按照以上所讲的规则，就可以根据状态转换表或状态转换图画出对应的 SM 图来。例如，根据表 6.2.3 的状态转换表就可以画出图 6.2.3 所示计数器电路的 SM 图，如图 6.2.7 所示。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.7_SM图.png"/><br>
</div>

#### 四、时序图

为便于用实验观察的方法查询时序电路的逻辑功能，还可以将状态转换表的内容画成时间波形的形式。**在输入信号和时钟脉冲序列的作用下，电路状态、输出状态随时间变化的波形图称为时序图**。

图 6.2.8 和图 6.2.9 中画出了图 6.2.1 和图 6.2.3 所示电路的时序图。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.8_时序图.png"/><br>
</div>

利用时序图检查时序电路逻辑功能的方法不仅用在实验测试中，也用于数字电路的计算机模拟当中。

### 6.2.3 异步时序逻辑电路的分析方法

异步时序电路的分析方法和同步时序电路的分析方法有所不同。在异步时序电路中，每次电路状态发生转换时并不是所有触发器都有时钟信号。只有那些有时钟信号的触发器才需要用特性方程去计算次态，而没有时钟信号的触发器将保持原来的状态不变。

因此，在分析异步时序电路时还需要找出每次电路状态转换时哪些触发器有时钟信号，哪些触发器没有时钟信号。可见，分析异步时序电路要比分析同步时序电路复杂。

下面通过一个例子具体说明一下分析的方法和步骤。

【例 6.2.4】已知异步时序电路的逻辑图如图 6.2.10 所示，试分析它的逻辑功能，画出电路的状态转换图和时序图。触发器和门电路均为 TTL 电路。【时钟信号前的小圆圈表示下降沿有效，即 $clk$ 从 1 翻到 0 触发】

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.10_时序逻辑电路.png"/><br>
</div>
首先根据逻辑图可写出驱动方程为
$$\begin{array}{ll} J_0=K_0=1 &\\\ J_1=Q_3', &K_1=1\\\ J_2=K_2=1\\\ J_3=Q_1Q_2, &K_3=1 \end{array} \tag{6.2.7}$$
将式（6.2.7）代入 JK 触发器的特性方程 $Q^*=JQ'+K'Q$ 后得到电路的状态方程
$$\begin{align} &Q_0^*=Q_0'\cdot clk_0\\\ &Q_1^*=Q_3'Q_1'\cdot clk_1\\\ &Q_2^*=Q_2'\cdot clk_2\\\ &Q_3^*=Q_1Q_2Q_3'\cdot clk_3 \end{align} \tag{6.2.8}$$

<mark>式中以小写的 clk 表示时钟信号，它不是一个逻辑变量。对下降沿动作的触发器而言，clk=1 仅表示时钟输人端有下降沿到达：对上升沿动作的触发器而言，clk=1 表示时钟输人端有上升沿到达。clk=0 表示没有时钟信号到达，触发器保持原来的状态不变</mark>。

根据电路图写出输出方程为
$$C=Q_0Q_3 \tag{6.2.9}$$

为了画电路的状态转换图，需列出电路的状态转换表。在计算触发器的次态时，首先应找出每次电路状态转换时各个触发器是否有 $clk$ 信号。为此，可以从给定的 $clk_0$ 连续作用下列出 $Q_0$ 的对应值（如表 6.2.4 中所示）。根据 $Q_0$ 每次从 1 变 0 的时刻产生 $clk_1$ 和 $clk_3$ 即可得到表 6.2.4 中 $clk_1$ 和 $clk_3$ 的对应值。而 $Q_1$ 每次从 1 变 0 的时刻将产生 $clk_2$。以 $Q_3Q_2Q_1Q_0=0000$ 为初态代入式（6.2.8）和式（6.2.9）依次计算下去，就得到了表 6.2.4 所示的状态转换表。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\表6.2.4_状态转换表.png"/><br>
</div>

由于图 6.2.10 所示电路中有 4 个触发器，它们的状态组合有 16 种，而表 6.2.4 中只包含了 10 种，因此需要分别求出其余 6 种状态下的输出和次态。将这些计算结果补充到表 6.2.4 中，才是完整的状态转换表。完整的电路状态转换图如图 6.2.11 所示。状态转换图表明，当电路处于表 6.2.4 中所列 10 种状态以外的任何一种状态时，都会在时钟信号作用下最终进入表 6.2.4 中的状态循环中去。具有这种特点的时序电路称为能够自行启动的时序电路。

从图 6.2.11 的状态转换图还可以看出，图 6.2.10 电路是一个异步十进制加法计数器电路。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.2.11_状态转换图.png"/><br>
</div>

## 6.3 若干常用的时序逻辑电路

### 6.3.1 移位寄存器

**移位寄存器**（Shift Register）除了具有存储代码的功能以外，还具有移位功能。所谓移位功能，是指寄存器里存储的代码能在移位脉冲的作用下依次左移或右移。因此，移位寄存器不但可以用来寄存代码，还可以用来实现数据的**串行-并行转换**、**数值的运算**以及**数据处理**等。

图 6.3.1 所示电路是**由边沿触发方式的 D 触发器组成的 4 位移位寄存器**，其中第一个触发器 FF<sub>0</sub> 的输入端接收输入信号，其余的每个触发器输入端均与前边一个触发器的 $Q$ 端相连。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.1_移位寄存器.png"/><br>
</div>

因为从 $CLK$ 上升沿到达开始到输出端新状态的建立需要经过一段传输延迟时间，所以当 $CLK$ 的上升沿同时作用于所有的触发器时，它们输入端（$D$ 端）的状态还没有改变。于是 FF<sub>1</sub> 按 $Q_0$ 原来的状态翻转，FF<sub>2</sub> 按 $Q_1$ 原来的状态翻转，FF<sub>3</sub> 按 $Q_2$ 原来的状态翻转。同时，加到寄存器输入端 $D_1$ 的代码存入 FF<sub>0</sub>。总的效果相当于移位寄存器里原有的代码依次右移了 1 位。

例如，在 4 个时钟周期内输入代码依次为 1011，而移位寄存器的初始状态为 $Q_0Q_1Q_2Q_3=0000$，那么在移位脉冲（也就是触发器的时钟脉冲）的作用下，移位寄存器里代码的移动情况将如表 6.3.1 所示。图 6.3.2 给出了各触发器输出端在移位过程中的电压波形图。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\表6.3.1_移位接寄存器中代码的移动状况.png"/><br>
</div>

<div align=center>
<img width=40% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.2_图6.3.1电路的电压波形.png"/><br>
</div>

可以看到，经过 4 个 $CLK$ 信号以后，串行输入的 4 位代码全部移人了移位寄存器中，同时在 4 个触发器的输出端得到了并行输出的代码。因此，利用移位寄存器可以实现代码的**串行-并行转换**。

如果首先将 4 位数据并行地置入移位寄存器的 4 个触发器中，然后连续加入 4 个移位脉冲，则移位寄存器里的 4 位代码将从串行输出端 $D_0$ 依次送出，从而实现了数据的**并行-串行转换**。

图 6.3.3 是用 JK 触发器组成的 4 位移位寄存器，它和图 6.3.1 所示电路具有同样的逻辑功能。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.3_用JK触发器构成的移位寄存器.png"/><br>
</div>

为便于扩展逻辑功能和增加使用的灵活性，在定型生产的移位寄存器集成电路上有的又附加了**左、右移控制**、**数据并行输入**、**保持**、**异步置零（复位）**等功能。图 6.3.4 给出的 74HC194A4 位双向移位寄存器就是一个典型的例子。

### 6.3.2 计数器

在数字系统中使用得最多的时序电路要算是**计数器**了。计数器不仅能用于**对时钟脉冲计数**，还可以用于**分频**、**定时**、**产生节拍脉冲和脉冲序列**以及**进行数字运算**等。

计数器的种类非常繁多。如果按计数器中的触发器是否同时翻转分类，可以将计数器分为**同步式**和**异步式**两种。在同步计数器中，当时钟脉冲输入时触发器的翻转是同时发生的。而在异步计数器中，触发器的翻转有先有后，不是同时发生的。

如果按计数过程中计数器中的数字增减分类，又可以将计数器分为**加法计数器**、**减法计数器**和**可逆计数器**（或称为**加/减计数器**）。随着计数脉冲的不断输入而作递增计数的称为加法计数器，作递减计数的称为减法计数器，可增可减的称为可逆计数器。

如果按计数器中数字的编码方式分类，还可以分成**二进制计数器**、**二—十进制计数器**、**格雷码计数器**等。

此外，有时也用计数器的计数容量来区分各种不同的计数器，如**十进制计数器**、**六十进制计数器**等。

#### 一、同步计数器

##### 1. 同步二进制计数器

目前生产的同步计数器芯片基本上分为二进制和十进制两种。首先讨论同步二进制计数器。

根据二进制加法运算规则可知，在一个多位二进制数的末位上加 1 时，若其中第 $i$ 位（即任何一位）以下各位皆为 1 时，则第 i 位应改变状态（由 0 变成 1，由 1 变成 0）。而最低位的状态在每次加 1 时都要改变。例如

<div align=center>
<img width=30% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\二进制加法.png"/><br>
</div>

按照上述原则，最低的 3 位数都改变了状态，而高 4 位状态未变。

**同步计数器通常用 T 触发器构成**，结构形式有两种。一种是控制输入端 $T$ 的状态。当每次 $CLK$ 信号（也就是计数脉冲）到达时，使该翻转的那些触发器输入控制端 $T_i=1$，不该翻转的 $T_i=0$。另一种形式是控制时钟信号，每次计数脉冲到达时，只能加到该翻转的那些触发器的 $CLK$ 输入端上，而不能加给那些不该翻转的触发器。同时，将所有的触发器接成 $T=1$ 的状态。这样，就可以用计数器电路的不同状态来记录输入的 $CLK$ 脉冲数目。

由此可知，当通过 $T$ 端的状态控制时，第 $i$ 位触发器输入端的逻辑式应为
$$\begin{align} T_i&=Q_{i-1} \cdot Q_{i-2} \cdot \cdots \cdot Q_1 \cdot Q_0 \\\ &=\prod_{j=0}^{i-1} Q_j \quad(i=1,2, \cdots, n-1) \end{align} \tag{6.3.1}$$
只有最低位例外，按照计数规则，每次输入计数脉冲时它都要翻转。故 $T_0=1$。

图 6.3.8 所示电路就是按式（6.3.1）接成的 4 位二进制同步加法计数器。由图可见，各触发器的驱动方程为
$$\begin{align} &T_0=1\\\ &T_1=Q_0\\\ &T_2=Q_0Q_1\\\ &T_3=Q_0Q_1Q_2 \end{align} \tag{6.3.2}$$

将上式代入 T 触发器的特性方程式得到电路的状态方程
$$\begin{align} &Q_0^*=Q_0'\\\ &Q_1^*=Q_0Q_1'+Q_0'Q_1\\\ &q_2^*=Q_0Q_1Q_2'+(Q_0Q_1)'Q_2\\\ &Q_3^*=Q_0Q_1Q_2Q_3'+(Q_0Q_1Q_2)'Q_3 \end{align}$$

电路的输出方程为
$$C=Q_0Q_1Q_2Q_3 \tag{6.3.4}$$

根据式（6.3.3）和式（6.3.4）求出电路的状态转换表，如表 6.3.3 所示。利用第 16 个计数脉冲到达时 C 端电位的下降沿可作为向高位计数器电路进位的输出信号。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\表6.3.3_图6.3.8电路的状态转换表.png"/><br>
</div>

图 6.3.9 和图 6.3.10 是图 6.3.8 所示电路的状态转换图和时序图。由时序图可以看出，若计数输入脉冲的频率为 $f_0$，则 $Q_0$、$Q_1$、$Q_2$ 和 $Q_3$ 端输出脉冲的频率将依次为 $\frac{1}{2}f_0$、$\frac{1}{4}f_0$、$\frac{1}{8}f_0$ 和 $\frac{1}{16}f_0$。针对计数器的这种分频功能，也将它称为**分频器**。

<div align=center>
<img width=40% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.9_图6.3.8电路的状态转换图.png"/><br>
</div>

此外，每输入 16 个计数脉冲计数器工作一个循环，并在输出端 $Q_3$ 产生一个进位输出信号，所以又将这个电路称为**十六进制计数器**。计数器中能计到的最大数称为计数器的容量，它等于计数器所有各位全为 1 时的数值。$n$ 位二进制计数器的容量等于 $2^n-1$。

在实际生产的计数器芯片中，往往还附加了一些控制电路，以增加电路的功能和使用的灵活性。图 6.3.11 为中规模集成的 4 位同步二进制计数器 74161 的逻辑图。这个电路除了具有二进制加法计数功能外，还具有预置数、保持和异步置零等附加功能。图中 $LD'$ 为预置数控制端，$D_0\sim D_3$ 为**数据输入端**，$C$ 为**进位输出端**，$R_D'$ 为**异步置零（复位）端**，$EP$ 和 $ET$ 为工作状态控制端。

<div align=center>
<img width=40% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.10_图6.3.8电路的时序图.png"/><br>
</div>

图 6.3.12 给出了**采用控制时钟信号方式构成的 4 位同步二进制计数器**。由于每个触发的 $T$ 输入端恒为 1，所以只要在每个触发器的时钟输人端加一个时钟脉冲 $clk_1$，这个触发器就要翻转一次。由图可见，对于除 FF<sub>0</sub> 以外的每个触发器，只有在低位触发器全部为 1 时，计数脉冲 $CLK$ 才能通过与门 $G_1\sim G_3$ 送到这些触发器的输入端而使之翻转。每个触发器的时钟信号可表示为
$$ clk*i=CLK \prod*{j=0}^{i-1} Q_j \quad(i=1,2, \cdots, n-1) \tag{6.3.5}$$
式中的 $clk_i$ 只表示一个完整的时钟脉冲，既不表示高电平也不表示低电平，$CLK$ 即输人的计数脉冲。

<div align=center>
<img width=40% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.12_4位同步二进制计数器的另一种形式.png"/><br>
</div>

根据二进制减法计数规则，在 $n$ 位二进制减法计数器中，只有当第 $i$ 位以下各位触发器同时为 0 时，再减 1 才能使第 $i$ 位触发器翻转。因此，采用控制 $T$ 端方式组成同步二进制减法计数器时，第 $i$ 位触发器输入端 $T_i$ 的逻辑式应为
$$T_i=Q_{i-1}' \cdot Q_{i-2}' \cdots \cdots \cdot Q_1' \cdot Q_0'=\prod_{j=0}^{i-1} Q_j' \quad(i=1,2, \cdots, n-1) \tag{6.3.6}$$

同理，采用控制时钟方式组成同步二进制减法计数器时，各触发器的时钟信号可写成
$$ clk*i=CLK \prod*{j=0}^{i-1} Q_j' \quad(i=1,2, \cdots, n-1) \tag{6.3.7}$$

图 6.3.13 所示电路是根据式（6.3.6）接成的同步二进制减法计数器电路，其中的 T 触发器是将 JK 触发器的 $J$ 和 $K$ 接在一起作为 $T$ 输入端而得到的。

在有些应用场合要求计数器既能进行递增计数又能进行递减计数，这就需要做成**加/减计数器**（或称之为**可逆计数器**）。

<div align=center>
<img width=40% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.13_用T触发器接成的同步二进制减法计数器.png"/><br>
</div>

##### 2. 同步十进制计数器

图 6.3.17 所示电路是用 T 触发器组成的**同步十进制加法计数器电路**，它是在图 6.3.10 同步二进制加法计数器电路的基础上略加修改而成的。

由图 6.3.17 可知，如果从 0000 开始计数，则直到输入第九个计数脉冲为止，它的工作过程与图 6.3.10 的二进制计数器相同。计入第九个计数脉冲后电路进入 1001 状态，这时 $Q_3'$ 的低电平使门 $G_1$ 的输出为 0，而 $Q_0$ 和 $Q_3$ 的高电平使门 $G_3$ 的输出为 1，所以 4 个触发器的输入控制端分别为 $T_0=1$、$T_1=0$、$T_2=0$、$T_3=1$。因此，当第十个计数脉冲输入后，FF<sub>1</sub> 和 FF<sub>2</sub> 维持 0 状态不变，FF<sub>0</sub> 和 FF<sub>3</sub> 从 1 翻转为 0，故电路返回 0000 状态。

<div align=center>
<img width=40% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.17_同步十进制加法计数器电路.png"/><br>
</div>

图 6.3.20 是**同步十进制减法计数器**的逻辑图。它也是从同步二进制减法计数器电路的基础上演变而来的。为了实现从 $Q_3Q_2Q_1Q_0=0000$ 状态减 1 后跳变成 1001 状态，在电路处于全 0 状态时用**与非门** $G_2$ 输出的低电平将与门 $G_1$ 和 $G_3$ 封锁，使 $T_1=T_@=0$。于是当计数脉冲到达后 FF<sub>0</sub> 和 FF<sub>3</sub> 翻成 1，而 FF<sub>1</sub> 和 FF<sub>2</sub> 维持 0 不变。以后继续输入减法计数脉冲时，电路的工作情况就与图 6.3.13 所示的同步二进制减法计数器一样了。

<div align=center>
<img width=40% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.20_同步十进制减法计数器电路.png"/><br>
</div>

#### 二、异步计数器

##### 1. 异步二进制计数器

**异步计数器在做“加 1”计数时是采取从低位到高位逐位进位的方式工作的**。因此，其中的各个触发器不是同步翻转的。

首先讨论二进制加法计数器的构成方法。按照二进制加法计数规则，每一位如果已经是 1，则再记入 1 时应变为 0，同时向高位发出进位信号，使高位翻转。若使用下降沿动作的 T 触发器组成计数器并令 $T=1$，则只要将低位触发器的 $Q$ 端接至高位触发器的时钟输入端就行了。当低位由 1 变为 0 时，$Q$ 端的下降沿正好可以作为高位的时钟信号。

图 6.3.23 是**用下降沿触发的 T 触发器组成的 3 位二进制加法计数器**，T 触发器是令 JK 触发器的 $J=K=1$ 而得到的。因为所有的触发器都是在时钟信号下降沿动作，所以进位信号应从低位的 $Q$ 端引出。最低位触发器的时钟信号 $CLK$。也就是要记录的计数输人脉冲。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.23_下降沿动作的异步二进制加法计数器.png"/><br>
</div>

根据 T 触发器的翻转规律即可画出在一系列 $CLK_0$ 脉冲信号作用下 $Q_0$、$Q_1$、$Q_2$ 的电压波形，如图 6.3.24 所示。由图可见，触发器输出端新状态的建立要比 $CLK$ 下降沿滞后一个触发器的传输延迟时间 $t_{\rm{pd}}$。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.24_图6.3.23电路的时序图.png"/><br>
</div>

从时序图出发还可以列出电路的状态转换表，画出状态转换图。这些都和同步二进制计数器相同，不再重复。

用上升沿触发的 T 触发器同样可以组成异步二进制加法计数器，但每一级触发器的进位脉冲应改由 $Q'$ 端输出。

如果将 T 触发器之间按二进制减法计数规则连接，就得到**二进制减法计数器**。按照二进制减法计数规则，若低位触发器已经为 0，则再输入一个减法计数脉冲后应翻成 1，同时向高位发出借位信号，使高位翻转。图 6.3.25 就是按上述规则接成的 3 位二进制减法计数器。图中仍采用下降沿动作的 JK 触发器接成 T 触发器使用，并令 $T=1$。它的时序图如图 6.3.26 所示。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.25_下降沿动作的异步二进制减法计数器.png"/><br>
</div>

将异步二进制减法计数器和异步二进制加法计数器做个比较即可发现，**它们都是将低位触发器的一个输出端接到高位触发器的时钟输入端而组成的**。在采用下降沿动作的 T 触发器时，加法计数器以 $Q$ 端为输出端，减法计数器以 $Q'$ 端为输出端。而在采用上升沿动作的 T 触发器时，情况正好相反，加法计数器以 $Q'$ 端为输出端，减法计数器以 $Q$ 端为输出端。目前常见的异步二进制加法计数器产品有 4 位的（如 74LS293、74LS393、74HC393 等）、7 位的（如 CC4024 等）、12 位的（如 74HC4040 等）和 14 位的（如 74HC4020 等）几种类型。

##### 2. 异步十进制计数器

异步十进制加法计数器是在 4 位异步二进制加法计数器的基础上加以修改而得到的。修改时要解决的问题是如何使 4 位二进制计数器在计数过程中跳过从 1010 到 1111 这 6 个状态。

图 6.3.27 所示电路是异步十进制加法计数器的典型电路。假定所用的触发器为 TTL 电路，$J$、$K$ 端悬空时相当于接逻辑 1 电平。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.27_异步十进制加法计数器的典型电路.png"/><br>
</div>

如果计数器从 $Q_3Q_2Q_1Q_0=0000$ 开始计数，由图可知在输人第八个计数脉冲以前 FF<sub>0</sub>、FF<sub>1</sub> 和 FF<sub>2</sub> 的 $J$ 和 $K$ 始终为 1，即工作在 T 触发器的 $T=1$ 状态，因而工作过程和异步二进制加法计数器相同。在此期间虽然 $Q_0$ 输出的脉冲也送给了 FF<sub>3</sub>，但由于每次 $Q_0$ 的下降沿到达时 $J_3=Q_1Q_2=0$，所以 FF<sub>3</sub> 一直保持 0 状态不变。

当第八个计数脉冲输入时，由于 $J_3=K_3=1$，所以 $Q_0$ 的下降沿到达以后 FF<sub>3</sub> 由 0 变为 1。同时，$J_1$ 也随 $Q_3'$ 变为 0 状态。第九个计数脉冲输人以后，电路状态变成 $Q_3Q_2Q_1Q_0=1001$。第十个计数脉冲输入后，FF<sub>0</sub> 翻成 0，同时 $Q_0$ 的下降沿使 FF<sub>3</sub> 置 0，于是电路从 1001 返回到 0000，跳过了 1010\~1111 这 6 个状态，成为**十进制计数器**。

将上述过程用电压波形表示，即得图 6.3.28 所示的时序图。根据时序图又可列出电路的状态转换表，画出电路的状态转换图。

<div align=center>
<img width=40% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.28_图6.3.27电路的时序图.png"/><br>
</div>

通过这个例子可以看到，在分析一些比较简单的异步时序电路时，可以采取从物理概念出发直接画波形图的方法分析它的功能，而不一定要按前面介绍的异步时序电路的分析方法去写方程式。

在讨论异步时序电路的分析方法时曾以图 6.2.10 所示电路作为例子（见例 6.2.4），它与图 6.3.27 所示电路的差别仅在于多一个进位输出端 $C$。因此，图 6.2.10 所示电路的状态转换表和状态转换图就是异步十进制加法计数器的状态转换表和状态转换图。

74LS290 就是按照图 6.3.27 所示电路的原理制成的异步十进制加法计数器，它的逻辑图示于图 6.3.29 中。为了增加使用的灵活性，FF<sub>1</sub> 和 FF<sub>3</sub> 的 $CLK$ 端没有与 $Q_0$ 端连在一起，而从 $CLK_1$ 端单独引出。若以 $CLK_0$ 为计数输入端、$Q_0$ 为输出端，即得到**二进制计数器（或二分频器）**；若以 $CLK_1$ 为输入端、$Q_3$ 为输出端，则得到**五进制计数器（或五分频器）**；若将 $CLK_1$ 与 $Q_0$ 相连，同时以 $CLK_0$ 为输入端、$Q_3$ 为输出端，则得到**十进制计数器（或十分频器）**。因此，又将这个电路称为**二—五—十进制异步计数器**。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.29_二五十进制异步计数器74LS290.png"/><br>
</div>

此外，在图 6.3.29 电路中还设置了两个置 0 输人端 $R_01$、$R_02$ 和两个置 9 输人端 $S_{91}$、$S_{92}$，以便于工作时根据需要将计数器预先置成 0000 或 1001 状态。

和同步计数器相比，异步计数器具有结构简单的优点。在用 T 触发器构成二进制计数器时，可以不附加任何其他电路。但异步计数器也存在两个明显的缺点。第一个缺点是工作频率比较低。因为异步计数器的各级触发器是以串行进位方式连接的，所以在最不利的情况下要经过所有各级触发器传输延迟时间之和以后，新状态才能稳定建立起来。第二个缺点是在电路状态译码时存在竞争-冒险现象。这两个缺点使异步计数器的应用受到了很大的限制。

#### 三、任意进制计数器的构成方法

#### 四、移位寄存器型计数器

##### 1. 环形计数器

如果按图 6.3.40 所示的那样将移位寄存器首尾相接，即 $D_0=Q_3$，那么在连续不断地输入时钟信号时寄存器里的数据将循**环右移**。

<div align=center>
<img width=50% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.40_环形计数器电路.png"/><br>
</div>

例如，电路的初始状态为 $Q_0Q_1Q_2Q_3=1000$，则不断输入时钟信号时电路的状态将按 1000→0100→0010→0001→1000 的次序循环变化。因此，用电路的不同状态能够表示输入时钟信号的数目，也就是说，可以把这个电路作为**时钟脉冲的计数器**。

根据移位寄存器的工作特点，不必列出环形计数器的状态方程即可直接画出图 6.3.41 所示的状态转换图。如果取由 1000、0100、0010 和 0001 所组成的状态循环为所需要的**有效循环**，那么同时还存在着其他几种**无效循环**。而且，一旦脱离有效循环之后，电路将不会自动返回有效循环中去，所以图 6.3.40 所示的环形计数器是不能自启动的。为确保它能正常工作，必须首先通过串行输入端或并行输入端将电路置成有效循环中的某个状态，然后再开始计数。

考虑到使用的方便，在许多场合下需要计数器能自启动，亦即当电路进入任何无效状态后，都能在时钟信号作用下自动返回有效循环中去。通过在输出与输入之间接入适当的反馈逻辑电路，可以将不能自启动的电路修改为能够自启动的电路。图 6.3.42 所示电路是能自启动的 4 位环形计数器电路。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.42_能自启动的环形计数器电路.png"/><br>
</div>

根据图 6.3.42 所示的逻辑图得到它的状态方程为
$$\begin{align} &Q_0^*=(Q_0+Q_1+Q_2)'\\\ &Q_1^*=Q_0\\\ Q_2^*=Q_1\\\ Q_3^*=Q_2 \end{align} \tag{6.3.14}$$
并可画出电路的状态转换图，如图 6.3.43 所示。

<div align=center>
<img width=50% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.43_图6.3.44电路的状态转换图.png"/><br>
</div>

环形计数器的突出优点是电路结构极其简单。而且，在有效循环的每个状态只包含一个 1（或 0）时，可以直接以各个触发器输出端的 1 状态表示电路的一个状态，不需要另外加译码电路。

**它的主要缺点是没有充分利用电路的状态**。用 $n$ 位移位寄存器组成的环形计数器只用了 $n$ 个状态，而电路总共有 $2^n$ 个状态，这显然是一种浪费。

##### 2. 扭环形计数器

为了在不改变移位寄存器内部结构的条件下提高环形计数器的电路状态利用率，只能在改变反馈逻辑电路上想办法。

事实上任何一种移位寄存器型计数器的结构均可表示为图 6.3.44 所示的一般形式，其中反馈逻辑电路的函数表达式可写成
$$D_0=F(Q_0,Q_1,...,Q_{n-1}) \tag{6.3.15}$$

<div align=center>
<img width=50% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.44_移位寄存器型计数器的一般结构形式.png"/><br>
</div>

环形计数器是反馈逻辑函数中最简单的一种，即 $D_0=Q_{n-1}$。若将反馈逻辑函数取为 $D_0=Q_{n-1}'$，则得到的电路如图 6.3.45 所示。这个电路称为**扭环形计数器**（也称为**约翰逊计数器**）。如将它的状态转换图画出，则如图 6.3.46 所示。不难看出，它有两个状态循环，若取图中左边的一个为有效循环，则余下的一个就是无效循环了。显然，这个计数器不能自启动。

<div align=center>
<img width=50% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.45_扭环形计数器电路.png"/><br>
</div>

为了实现自启动，可将图 6.3.45 所示电路的反馈逻辑函数稍加修改，令 $D_0=Q_1Q_2'+Q_3'$，于是就得到了图 6.3.47 所示的电路和图 6.3.48 所示的状态转换图。

<div align=center>
<img width=50% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.47_能自启动的扭环形计数器.png"/><br>
</div>

不难看出，用 $n$ 位移位寄存器构成的扭环形计数器可以得到含 $2n$ 个有效状态的循环，状态利用率较环形计数器提高了一倍。而且，如采用图 6.3.48 中的有效循环，由于电路在每次状态转换时只有一位触发器改变状态，因而在将电路状态译码时不会产生竞争-冒险现象。

虽然扭环形计数器的电路状态利用率有所提高，但仍有 $2^n-2n$ 个状态没有利用。使用最大长度移位寄存器型计数器可以将电路的状态利用率提高到 $2^n-1$，有关内容可参阅本书第三版中的附录 5E。

### 6.3.3 顺序脉冲发生器

在一些数字系统中，有时需要系统按照事先规定的顺序进行一系列的操作。这就要求系统的控制部分能给出一组在时间上有一定先后顺序的脉冲信号，再用这组脉冲形成所需要的各种控制信号。顺序脉冲发生器就是用来产生这样一组顺序脉冲的电路。

**顺序脉冲发生器可以用移位寄存器构成**。当环形计数器工作在每个状态中只有一个 1 的循环状态时，它就是一个顺序脉冲发生器。由图 6.3.49 可见，当 $CLK$ 端不断输入系列脉冲时，$Q_0\sim Q_3$ 端将依次输出正脉冲，并不断循环。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.49_用环形计数器作顺序脉冲发生器.png"/><br>
</div>

这种方案的优点是不必附加译码电路，结构比较简单。缺点是使用的触发器数目比较多，同时还必须采用能自启动的反馈逻辑电路。

### 6.3.4 序列信号发生器

在数字信号的传输和数字系统的测试中，有时需要用到一组特定的**串行数字信号**。通常将这种串行数字信号称为序列信号。产生序列信号的电路称为**序列信号发生器**。

序列信号发生器的构成方法有多种。一种比较简单、直观的方法是用计数器和数据选择器组成。例如，需要产生一个 8 位的序列信号 00010111（时间顺序为自左而右），则可用一个**八进制计数器**和一个 **8 选 1 数据选择器**组成，如图 6.3.53 所示。其中八进制计数器取自 74LS161（4 位二进制计数器）的低 3 位。74LS152 是 8 选 1 数据选择器。

<div align=center>
<img width=50% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.3.53_用计数器和数据选择器组成的序列信号发生器.png"/><br>
</div>

当 $CLK$ 信号连续不断地加到计数器上时，$Q_2Q_1Q_0$ 的状态（也就是加到 74LS152 上的地址输入代码 $A_2A_1A_0$）便按照表 6.3.8 中所示的顺序不断循环，$D_0'\sim D_7'$ 的状态就循环不断地依次出现在 $Y'$ 端。只要令 $D_0=D_1=D_2=D_4=1$、$D_3=D_5=D_6=D_7=0$，便可在 $Y'$ 端得到不断循环的序列信号 00010111。在需要修改序列信号时，只要修改加到 $D_0~D_7$ 的高、低电平即可实现，而不需对电路结构做任何更动。因此，使用这种电路既灵活又方便。

<div align=center>
<img width=80% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\表6.3.8_图6.3.53电路的状态转换表.png"/><br>
</div>

## 6.4 时序逻辑电路的设计方法

### 6.4.1 同步时序逻辑电路的设计方法

在设计时序逻辑电路时，要求设计者根据给出的具体逻辑问题，求出实现这一逻辑功能的逻辑电路。所得到的设计结果应力求简单。在这一小节里我们首先讨论简单时序电路的设计。这里所说的**简单时序电路**，**是指用一组状态方程、驱动方程和输出方程就能完全描述其逻辑功能的时序电路**。

**当选用小规模集成电路做设计时，电路最简的标准是用的触发器和门电路的数目最少，而且触发器和门电路的输入端数目也最少**。**而当使用中、大规模集成电路时，电路最简的标准则是使用的集成电路数目最少，种类最少，而且互相间的连线也最少**。

设计同步时序逻辑电路时，一般按如下步骤进行：

#### 一、逻辑抽象，得出电路的状态转换图或状态转换表

就是将要求实现的时序逻辑功能表示为时序逻辑函数，可以用**状态转换表**的形式，也可以用**状态转换图**或**状态机流程图**的形式。这就需要：

1. 分析给定的逻辑问题，确定**输入变量**、**输出变量**以及**电路的状态数**。通常都是取原因（或条件）作为输入逻辑变量，取结果作输出逻辑变量。
2. 定义输入、输出逻辑状态和每个电路状态的含意，并将电路状态顺序编号。
3. 按照题意列出电路的状态转换表或画出电路的状态转换图。

这样，就把给定的逻辑问题抽象为一个时序逻辑函数了。

#### 二、状态化简

若两个电路状态在相同的输入下有相同的输出，并且转换到同样一个次态去，则称这两个状 6.4 时序逻辑电路的设计方法态为等价状态。显然，等价状态是重复的，可以合并为一个。电路的状态数越少，设计出来的电路就越简单。

状态化简的目的就在于将等价状态合并，以求得最简的状态转换图。

#### 三、状态分配

状态分配又称**状态编码**。

**时序逻辑电路的状态是用触发器状态的不同组合来表示的**。首先，需要确定触发器的数目 $n$。因为 $n$ 个触发器共有 $2^n$ 种状态组合，所以为获得时序电路所需的 $M$ 个状态，必须取
$$2^{n-1} < M \le 2^n  \tag{6.4.1}$$

其次，要给每个电路状态规定对应的触发器状态组合。每组触发器的状态组合都是一组二值代码，因而又将这项工作称为状态编码。在 $M<2^n$ 的情况下，从 $2^n$ 个状态中取 $M$ 个状态的组合可以有多种不同的方案，而每个方案中 $M$ 个状态的排列顺序又有许多种。如果编码方案选择得当，设计结果可以很简单。反之，编码方案选得不好，设计出来的电路就会复杂得多，这里面有一定的技巧。

此外，为便于记忆和识别，一般选用的状态编码和它们的排列顺序都遵循一定的规律。

#### 四、选定触发器的类型，求出电路的状态方程、驱动方程和输出方程

因为不同逻辑功能的触发器驱动方式不同，所以用不同类型触发器设计出的电路也不一样。为此，在设计具体的电路前必须选定触发器的类型。选择触发器类型时应考虑到器件的供应情况，并应力求减少系统中使用的触发器种类。

根据状态转换图（或状态转换表）和选定的状态编码、触发器的类型，就可以写出电路的**状态方程**、**驱动方程**和**输出方程**了。

#### 五、根据得到的方程式画出逻辑图

#### 六、检查设计的电路能否自启动

如果电路不能自启动，则需采取措施加以解决。一种解决办法是在电路开始工作时通过预置数将电路的状态置成有效状态循环中的某一种。另一种解决方法是通过修改逻辑设计加以解决。具体的作法将在下一小节中介绍。

至此，逻辑设计工作已经完成。图 6.4.1 用方框图表示了上述设计工作的大致过程。不难看出，这一过程和分析时序电路的过程正好是相反的。

<div align=center>
<img width=60% src="computer_science\digital_electronics\数字电子技术基础_阎石\image\图6.4.1_同步时序逻辑电路的设计过程.png"/><br>
</div>

### 6.4.2 时序逻辑电路的自启动设计

在前面介绍时序电路的设计步骤时，检查电路能否自启动这一步是在最后进行的。如果发现电路不能自启动，而设计又要求电路能自启动，就必须回过头来重新修改设计了。那么能否在前面的设计过程中就注意到电路能否自启动，并且在发现不能自启动时采取措施加以解决呢？

事实上这是可以做到的，下面通过一个例子来说明。

### 6.4.3 异步时序逻辑电路的设计方法

由于异步时序电路中的触发器不是同时动作的，因而在设计异步时序电路时除了需要完成设计同步时序电路所应做的各项工作以外，还要为每个触发器选定合适的时钟信号。这就是设计异步时序电路时所遇到的特殊问题。

设计步骤大体上仍可按 6.4.1 节中所讲的同步时序电路的设计步骤进行，只是在选定触发器类型之后，还要为每个触发器选定时钟信号。下面通过一个例子具体说明一下设计过程。

### 6.4.4 复杂时序逻辑电路的设计

在一些复杂的时序电路中，往往会包含为数众多的输入变量、输出变量、电路状态，而且存在多种状态循环和需要完成各种逻辑运算。这时已难于用一组状态方程、驱动方程和输出方程描述整个电路的逻辑功能了，因此简单地套用前面讲过的设计方法显然已经行不通了。

在这种情况下，通常采用层次化结构设计方法，或者称为模块化设计方法。层次化结构设计方法有“自顶向下”（Top-down）和“自底向上”（Bottom-up）两种做法。采用自顶向下的做法时，首先需要将所设计电路的功能逐级划分为更简单的功能模块，直到这些模块都能用简单的逻辑电路实现为止。这些简单的逻辑电路都可以用我们前面讲过的设计方法来设计。由于电路规模较大、功能复杂，所以经常需要有一个控制模块去协调各模块之间的操作。有人又将这类能明显地划分出控制模块的数字电路称为数字系统。其实究竟电路复杂到什么程度才叫做系统并无十分明确的界定。

由于自顶向下划分模块的过程中完全是从获得最佳电路性能出发的，并未考虑这些模块电路是否已经有成熟的设计存在了，所以必须从头设计每个模块电路，然后进行仿真和测试。在发现问题时，还需反复修改。即便如此，在做成硬件电路以后，也不能保证绝对不出现问题。

在采取自底向上的做法时，首先要考虑有哪些已有的、成熟的模块电路可以利用。这些模块电路可能是标准化的集成电路器件，也可能是经过验证的计算机软件。将电路划分为功能模块时，最后要划分到能利用这些已有的模块电路来实现为止。直接采用这些模块电路能大大减少设计的工作量。然而有时由于需要迁就已有的模块电路，这就会使电路的某些性能受到一些影响。另外，也不可能任何一种功能模块都有现成的成熟设计，因此多数情况下都采用自顶向下和自底向上相结合的方法，以求达到既能满足设计要求，又能提高设计速度、降低设计成本的目标。

## 6.5 用可编程逻辑器件实现同步时序逻辑电路

## 6.6 时序逻辑电路中的竞争-冒险现象

因为时序逻辑电路通常都包含**组合逻辑电路**和**存储电路**两个组成部分，所以它的竞争—冒险现象也包含两个方面。

一方面是其中的组合逻辑电路部分可能发生的竞争-冒险现象。产生这种现象的原因已在 4.4.1 节中讲过。这种由于竞争而产生的尖峰脉冲并不影响组合逻辑电路的稳态输出，但如果它被存储电路中的触发器接收，就可能引起触发器的误翻转，造成整个时序电路的误动作，这种现象必须绝对避免。消除组合逻辑电路中竞争—冒险现象的方法已在 4.4.3 节中做了介绍，这里不再重复。

另一方面是**存储电路（或者说是触发器）工作过程中发生的竞争—冒险现象**，这也是时序电路所特有的一个问题。

在讨论触发器的动态特性时曾经指出，为了保证触发器可靠地翻转，输入信号和时钟信号在时间配合上应满足一定的要求。**然而当输入信号和时钟信号同时改变，而且途经不同路径到达同一触发器时，便产生了竞争**。竞争的结果有可能导致触发器误动作，这种现象称为**存储电路（或触发器）的竞争—冒险现象**。

例如，在图 6.6.1 给出的八进制异步计数器电路中，就存在着这种存储电路的竞争-冒险现象。
