本章介绍以下内容：

- 运算符：`=`
- 函数：`main()`、`printf()`
- 编写一个简单的 C 程序
- 创建**整型变量**，为其赋值并在屏幕上显示其值
- **换行字符**
- 如何在程序中写**注释**，创建包含多个函数的程序，发现程序的错误
- 什么是**关键字**

## 2.1 一个简单的 C 程序实例及示例解释

```c
// 程序清单 2.1 first.c 程序
#include <stdio.h>
int main(void)                 /* 一个简单的 C 程序 */
{
    int num;                   /* 定义一个名为 num 的变量 */
    num = 1;                   /* 为 num 赋一个值 */

    printf("I am a simple ");  /* 使用 printf() 函数 */
    printf("computer.\n");
    printf("My favorite number is %d because it is first.\n", num);

    return 0;
}
```

运行：

```c
I am a simple computer.
My favorite number is 1 because it is first.
```

程序由一个或多个**函数**组成，必须有 `main()` 函数。函数由**函数头**和**函数体**组成。函数头包括**函数名**、**传入该函数的信息类型**和**函数的返回类型**。通过函数名后的圆括号可识别出函数，圆括号里可能为空，可能有参数。函数体被**花括号**括起来，由一系列**语句**、**声明**组成。

<div align=center>
<img width="60%" src="\programme\C_C++\C_primer_plus\image\C程序解剖.png"/> <br>
<div style="text-align: justify; display: inline-block; color: #5b5b5b; padding: 2px;"> C程序解剖。</div>
</div>

## 2.2 示例解释

### 2.2.1 第 1 遍：快速概要

1. `#include <stdio.h>` ← 包含另一个文件
   - 该行告诉编译器把 `stdio.h` 中的内容包含在当前程序中。`stdio.h` 是 C 编译器软件包的标准部分，它提供**键盘输入**和**屏幕输出**的支持。
2. `int main(void)` ← 函数名
   - C 程序包含一个或多个函数，它们是 C 程序的基本模块。
   - `main()` 函数：**圆括号**表明 `main()` 是一个函数名。`int` 表明 `main()` 函数返回一个整数，`void` 表明 `main()` 不带任何参数。
3. `/* 一个简单的C程序 */` ← 注释
   - 注释在 `/*` 和 `*/` 两个符号之间，这些注释能提高程序的可读性。注意，注释只是为了帮助读者理解程序，编译器会忽略它们。
4. `{` ← 函数体开始
   - **左花括号**表示函数定义开始，**右花括号**（`}`）表示函数定义结束。
5. `int num;` ← 声明
   - 该声明表明，将使用一个名为 `num` 的变量，而且 `num` 是 `int`（整数）类型。
6. `num = 1;` ← 赋值表达式语句
   - 语句 `num = 1;` 把值 `1` 赋给名为 `num` 的变量。
7. `printf("I am a simple );` ← 调用一个函数
   - 该语句使用 `printf()` 函数，在屏幕上显示 `I am a simple`，光标停在同一行。`printf()` 是标准的 C 库函数。在程序中使用函数叫作**调用函数**。
8. `printf("computer.\n");` ← 调用另一个函数
   - 接下来调用的这个 `printf()` 函数在上条语句打印出来的内容后面加上 `computer`。代码 `\n` 告诉计算机另起一行，即把光标移至下一行。
9. `printf("My favorite number is %d because it is first.\n", num);`
   - 最后调用的 `printf()` 把 `num` 的值（`1`）内嵌在用双引号括起来的内容中一并打印。`%d` 告诉计算机以何种形式输出 `num` 的值，打印在何处。
10. `return 0;` ← `return` 语句
    - C 函数可以给调用方提供（或返回）一个数。
11. `}` ← 结束
    - 必须以**右花括号**表示程序结束。

### 2.2.2 第 2 遍：程序细节

#### 1. #include 指令和头文件

`#include <stdio.h>`

- **#include <stdio.h> 的作用相当于把 stdio.h 文件中的所有内容都输入该行所在的位置**。实际上，这是一种“**拷贝-粘贴**”的操作。
- `#include` 这行代码是一条 C **预处理器指令**（preprocessor directive）。通常，C 编译器在编译前会对源代码做一些准备工作，即**预处理**（preprocessing）。`#include` 中的 `#` 符号表明，C 预处理器在编译器接手之前处理这条指令。
- `stdio.h` 文件包含了供编译器使用的**输入和输出函数**（如，`printf()`）信息。该文件名的含义是**标准输入/输出头文件**。通常，在 C 程序顶部的信息集合被称为**头文件**（header）。在大多数情况下，头文件包含了编译器创建最终可执行程序要用到的信息。例如，头文件中可以定义一些常量，或者指明函数名以及如何使用它们。但是，函数的实际代码在一个**预编译代码的库文件**中。简而言之，头文件帮助编译器把你的程序正确地组合在一起。
- ANSI/ISO C 规定了 C 编译器必须提供哪些头文件。有些程序要包含 `stdio.h`，而有些不用。特定 C 实现的文档中应该包含对 C 库函数的说明。这些说明确定了使用哪些函数需要包含哪些头文件。例如，要使用 `printf()` 函数，必须包含 `stdio.h` 头文件。省略必要的头文件可能不会影响某一特定程序，但是最好不要这样做。本书每次用到库函数，都会用 `#include` 指令包含 ANSI/ISO 标准指定的头文件。
- **为何不把输入和输出这些基本功能内置在语言中**？原因之一是，并非所有的程序都会用到 **I/O（输入/输出）包**。轻装上阵表现了 C 语言的哲学。正是这种经济使用资源的原则，使得 C 语言成为流行的**嵌入式编程语言**（例如，编写控制汽车自动燃油系统或蓝光播放机芯片的代码）。

#### 2. main() 函数

`int main(void)`

- C 程序一定从 `main()` 函数开始执行（目前不必考虑例外的情况）。除了 `main()` 函数，你可以任意命名其他函数，而且 `main()` 函数必须是开始的函数。**圆括号**用于识别 `main()` 是一个函数。
- `int` 是 `main()` 函数的返回类型。这表明 `main()` 函数返回的值是整数。**返回给操作系统**。
- 通常，函数名后面的圆括号中包含一些传入函数的参数。该例中没有传递任何参数。因此，圆括号内是单词 `void`。

#### 3. 注释

`/*一个简单的程序*/`

- 在程序中，被 `/*` `*/` 两个符号括起来的部分是程序的注释。写注释能让他人（包括自己）更容易明白你所写的程序。C 语言可将注释放在任意的地方，甚至是与要解释的内容在同一行。较长的注释可单独放一行或多行。在 `/*` 和 `*/` 之间的内容都会被编译器忽略。
- C99 新增了另一种风格的注释，普遍用于 C++ 和 Java。这种新风格使用 `//` 符号创建注释，**仅限于单行**。这种注释只能写成一行，因为一行末尾就标志着注释的结束，所以这种风格的注释只需在注释开始处标明 `//` 符号即可。

#### 4. 花括号、函数体和块

`{...}`

- 一般而言，所有的 C 函数都使用**花括号**标记函数体的开始和结束。
- 花括号还可用于把函数中的多条语句合并为一个**单元**或**块**。

#### 5. 声明

`int num;`

- **声明**是 C 语言最重要的特性之一。在该例中，声明完成了两件事。其一，在函数中有一个名为 `num` 的变量（variable）。其二，`int` 表明 `num` 是一个整数。`int` 是一种数据类型。编译器使用这些信息为 `num` 变量在内存中分配存储空间。**分号**在 C 语言中是大部分语句和声明的一部分。
- `int` 是 C 语言的一个**关键字**（keyword），表示一种基本的 C 语言数据类型。关键字是语言定义的单词，不能做其他用途。例如，不能用 `int` 作为函数名和变量名。
- 示例中的 `num` 是一个**标识符**（identifier），也就一个**变量**、**函数**或**其他实体**的名称。因此，声明把特定标识符与计算机内存中的特定位置联系起来，同时也确定了储存在某位置的信息类型或数据类型。
- <mark>在 C 语言中，所有变量都必须先声明才能使用</mark>。这意味着必须列出程序中用到的所有变量名及其类型。
- **C99 和 C11 遵循 C++ 的惯例，可以把声明放在块中的任何位置**。尽管如此，首次使用变量之前一定要先声明它。

##### 数据类型

C 语言可以处理多种类型的数据，如**整数**、**字符**和**浮点数**。把变量声明为整型或字符类型，计算机才能正确地储存、读取和解释数据。

##### 命名

给变量命名时要使用**有意义的变量名或标识符**（如，程序中需要一个变量数羊，该变量名应该是 `sheep_count` 而不是 `x3`）。如果变量名无法清楚地表达自身的用途，可在注释中进一步说明。这是一种良好的编程习惯和编程技巧。

<mark>C99 和 C11 允许使用更长的标识符名，但是编译器只识别前 63 个字符。对于外部标识符（参阅第 12 章），只允许使用 31 个字符</mark>。〔以前 C90 只允许 6 个字符，旧式编译器通常最多只允许使用 8 个字符。〕实际上，你可以使用更长的字符，但是编译器会忽略超出的字符。也就是说，如果有两个标识符名都有 63 个字符，只有一个字符不同，那么编译器会识别这是两个不同的名称。如果两个标识符都是 64 个字符，只有最后一个字符不同，那么编译器可能将其视为同一个名称，也可能不会。标准并未定义在这种情况下会发生什么。

**可以用小写字母、大写字母、数字和下划线（\_）来命名。而且，名称的第 1 个字符必须是字符或下划线，不能是数字**。

<mark>操作系统和 C 库经常使用以一个或两个下划线字符开始的标识符（如，\_kcab），因此最好避免在自己的程序中使用这种名称。标准标签都以一个或两个下划线字符开始，如库标识符。这样的标识符都是保留的。这意味着，虽然使用它们没有语法错误，但是会导致名称冲突</mark>。

**C 语言的名称区分大小写**，即把一个字母的大写和小写视为两个不同的字符。因此，stars 和 Stars、STARS 都不同。为了让 C 语言更加国际化，C99 和 C11 根据**通用字符名**（即 UCN）机制添加了**扩展字符集**。其中包含了除英文字母以外的部分字符。欲了解详细内容，请参阅附录 B 的“参考资料 VII：扩展字符支持”。

#### 6. 赋值

`num = 1;`

- 这行代码是**赋值表达式语句**。**赋值**是 C 语言的基本操作之一。该行代码的意思是“把值 `1` 赋给变量 `num`”。在执行 `int num;` 声明时，编译器在计算机内存中为变量 `num` 预留了空间，然后在执行这行赋值表达式语句时，把值储存在之前预留的位置。可以给 `num` 赋不同的值，这就是 `num` 之所以被称为变量（variable）的原因。注意，该赋值表达式语句从右侧把值赋到左侧。另外，该语句以分号结尾。
- <mark>C 语言是通过赋值运算符而不是赋值语句完成赋值操作</mark>。根据 C 标准，C 语言并没有所谓的“赋值语句”，本书及一些其他书籍中提到的“赋值语句”实际上是表达式语句（C 语言的 6 种基本语句之一）。

#### 7. printf() 函数

`printf("I am a simple ");`<br>
`printf("computer.\n");`<br>
`printf("My favorite number is %d because it is first.\n", num);`

- 圆括号表明 `printf` 是一个函数名。圆括号中的内容是从 `main()` 函数传递给 `printf()` 函数的信息。该信息被称为**参数**，或者更确切地说，是函数的**实际参数**（actual argument）。〔在 C 语言中，**实际参数**（简称**实参**）是传递给函数的特定值，**形式参数**（简称**形参**）是函数中用于储存值的变量。〕`printf()` 函数会查看双引号中的内容，并将其打印在屏幕上。
- 第 1 行 `printf()` 演示了在 C 语言中调用函数只需输入函数名，把所需的参数填入圆括号即可。当程序运行到这一行时，控制权被转给已命名的函数（该例中是 `printf()`）。函数执行结束后，控制权被返回至**主调函数**（calling function），该例中是 `main()`。
- 第 2 行 `printf()` 函数的双引号中的 `\n` 字符并未输出。`\n` 的意思是换行。`\n` 组合（依次输入这两个字符）代表一个**换行符**（newline character）。对于 `printf()` 而言，它的意思是“在下一行的最左边开始新的一行”。也就是说，**打印换行符的效果与在键盘按下 Enter 键相同**。既然如此，为何不在键入 `printf()` 参数时直接使用 `Enter` 键？因为编辑器可能认为这是直接的命令，而不是储存在在源代码中的指令。换句话说，如果直接按下 Enter 键，编辑器会退出当前行并开始新的一行。但是，换行符仅会影响程序输出的显示格式。
- **换行符**是一个**转义序列**（escape sequence）。**转义序列用于代表难以表示或无法输入的字符**。如，`\t` 代表 Tab 键，`\b` 代表 Backspace 键（退格键）。每个转义序列都以反斜杠字符（`\`）开始。
- 第 3 个 `printf()` 参数中的 `%d` 在打印时有什么作用？`%d` 相当于是一个**占位符**，其作用是指明输出 `num` 值的位置。`%` 提醒程序，要在该处打印一个变量，`d` 表明把变量作为十进制整数打印。`printf()` 函数名中的 `f` 提醒用户，这是一种**格式化打印函数**。`printf()` 函数有多种打印变量的格式，包括小数和十六进制整数。
- <mark>市面上许多书籍（包括本书）都把这种语句叫作“函数调用语句”，但是历年的 C 标准中从来没有函数调用语句！这样的“函数调用语句”实质是表达式语句</mark>。值得一提的是，**函数调用本身是一个表达式，圆括号是运算符，圆括号左边的函数名是运算对象**。在 C11 标准中，这样的表达式是一种**后缀表达式**。在表达式末尾加上分号，就成了**表达式语句**。

#### 8. return 语句

`return 0;`

- 在 C 语言中，`return` 语句是一种**跳转语句**。`int main(void)` 中的 `int` 表明 `main()` 函数应返回一个整数。有返回值的 C 函数要有 `return` 语句。该语句以`return`关键字开始，后面是待返回的值，并以分号结尾。如果遗漏 `main()` 函数中的 `return` 语句，程序在运行至最外面的右花括号（`}`）时会返回 `0`。因此，可以省略 `main()` 函数末尾的 `return` 语句。但是，不要在其他有返回值的函数中漏掉它。因此，强烈建议读者养成在 `main()` 函数中保留 `return` 语句的好习惯。在这种情况下，可将其看作是统一代码风格。但对于某些操作系统（包括 Linux 和 UNIX），`return` 语句有实际的用途。

## 2.4 提高程序可读性的技巧

1. 选择有意义的**函数名**；
2. 写**注释**；
3. 在函数中用**空行**分隔概念上的多个部分；
4. **每条语句各占一行**。分号告诉编译器一条语句在哪里结束、下一条语句在哪里开始。

## 2.5 进一步使用 C

```c
// 程序清单2.2 fathm_ft.c程序
// fathom_ft.c -- 把2英寻转换成英尺
// 英寻是航海用的深度单位，1英寻=6英尺=1.8米，通常用在海图上测量水深。
#include <stdio.h>
int main(void)
{
    int feet, fathoms;

    fathoms = 2;
    feet = 6 * fathoms;
    printf("There are %d feet in %d fathoms!\n", feet, fathoms);
    printf("Yes, I said %d feet!\n", 6 * fathoms);

    return 0;
}
```

运行：

```c
There are 12 feet in 2 fathoms!
Yes, I said 12 feet!
```

- 程序在开始处有一条注释（使用新的注释风格），给出了**文件名**和**程序的目的**。
- **程序在一条声明中声明了两个变量**，而不是一个变量。为此，要在声明中用**逗号隔开**两个变量（`feet` 和 `fathoms`）。
- 程序的第 1 个 `printf()` 中进行了两次替换。双引号号后面的第 1 个变量（`feet`）替换了双引号中的第 1 个 `%d`；双引号号后面的第 2 个变量（`fathoms`）替换了双引号中的第 2 个 `%d`。注意，待输出的变量列于双引号的后面。还要注意，**变量之间要用逗号隔开**。
- 第 2 个 `printf()` 函数说明待打印的值不一定是变量，只要可求值得出合适类型值的项即可，如 `6 * fathoms`。

## 2.6 多个函数

```c
/* 程序清单2.3 two_func.c程序 */
/* two_func.c -- 一个文件中包含两个函数*/
#include <stdio.h>
void butler(void); /* ANSI/ISO C函数原型 */
int main(void)
{
    printf("I will summon the butler function.\n");
    butler();
    printf("Yes. Bring me some tea and writeable DVDs.\n");

    return 0;
}
void butler(void) /* 函数定义开始 */
{
    printf("You rang, sir?\n");
}
```

Output：

```c
I will summon the butler function.
You rang, sir?
Yes. Bring me some tea and writeable DVDs.
```

- `butler()` 函数在程序中出现了 3 次。第 1 次是**函数原型**（prototype），**告知编译器在程序中要使用该函数**；第 2 次以**函数调用**（function call）的形式出现在 `main()` 中；最后一次出现在**函数定义**（function definition）中，**函数定义即是函数本身的源代码**。下面逐一分析。
- C90 标准新增了**函数原型**。函数原型是一种**声明形式**，**告知编译器正在使用某函数**，因此函数原型也被称为**函数声明**（function declaration）。函数原型还指明了函数的属性。例如，`butler()` 函数原型中的第 1 个 `void` 表明，`butler()` 函数没有返回值（通常，被调函数会向主调函数返回一个值，但是 `bulter()` 函数没有）。第 2 个 `void`（`butler(void)` 中的 `void`）的意思是 `butler()` 函数不带参数。因此，当编译器运行至此，会检查 `butler()` 是否使用得当。注意，`void` 在这里的意思是“空的”，而不是“无效”。
- 在 `main()` 中调用 `butler()` 很简单，写出函数名和圆括号即可。当 `butler()` 执行完毕后，程序会继续执行 `main()` 中的下一条语句。
- 程序的最后部分是 `butler()` 函数的定义，其形式和 `main()` 相同，都包含**函数头**和用花括号括起来的**函数体**。函数头重述了函数原型的信息：`bulter()` 不带任何参数，且没有返回值。
- 这里要注意，</mark>何时执行 butler() 函数取决于它在 main() 中被调用的位置，而不是 butler() 的定义在文件中的位置</mark>。例如，把 `butler()` 函数的定义放在 `main()` 定义之前，不会改变程序的执行顺序，`butler()` 函数仍然在两次 `printf()` 调用之间被调用。记住，无论 `main()` 在程序文件处于什么位置，所有的 C 程序都从 `main()` 开始执行。但是，C 的惯例是把 `main()` 放在开头，因为它提供了程序的基本框架。
- C 标准建议，要为程序中用到的所有函数提供函数原型。**标准 include 文件（包含文件）为标准库函数提供了函数原型**。例如，在 C 标准中，`stdio.h` 文件包含了 `printf()` 的函数原型。

## 2.7 调试程序

程序的错误通常叫做 **bug**，找出并修正错误的过程叫做**调试**（debug）。

### 2.7.1 语法错误

**语法错误**指的是把有效的 C 符号放在错误的地方。查看编译器是否发现错误，检查程序的语法错误是它的工作之一。

在编译程序时，编译器发现错误会报告错误信息，指出每一处错误的性质和具体位置。

**编译器另一个常见的毛病是，报错的位置比真正的错误位置滞后一行**。例如，编译器在编译下一行时才会发现上一行缺少分号。因此，如果编译器报错某行缺少分号，请检查上一行。

### 2.7.2 语义错误

**语义错误**是指意思上的错误。在 C 语言中，如果遵循了 C 规则，但是结果不正确，那就是犯了语义错误。

定位语义错误的方法之一是，把自己想象成计算机，跟着程序的步骤一步一步地执行。

### 2.7.3 程序状态

通过逐步跟踪程序的执行步骤，并记录每个变量，便可监视程序的状态。**程序状态**（program state）是在程序的执行过程中，某给定点上所有变量值的集合。它是计算机当前状态的一个**快照**。

定位语义错误的第二种方法是：**在程序中的关键点插入额外的 printf() 语句**，以监视制定变量值的变化。

定位语义错误的第三种方法是使用**调试器**。**调试器**（debugger）是一种程序，让你一步一步运行另一个程序，并检查该程序变量的值。调试器有不同的使用难度和复杂度。较高级的调试器会显示正在执行的源代码行号。这在检查有多条执行路径的程序时很方便，因为很容易知道正在执行哪条路径。

## 2.8 关键字和保留标识符

**关键字是 C 语言的词汇。它们对 C 而言比较特殊，不能用它们作为标识符**（如，变量名）。许多关键字用于指定不同的类型，如 `int`。还有一些关键字（如，`if`）用于控制程序中语句的执行顺序。

|             |              |                |                       |
| ----------- | ------------ | -------------- | --------------------- |
| auto        | extern       | short          | while                 |
| break       | float        | signed         | \_Alignas (C11)       |
| case        | for          | sizeof         | \_Alignof (C11)       |
| char        | goto         | static         | \_Atomic (C11)        |
| const (C90) | if           | struct         | \_Bool (C11)          |
| continue    | inline (C99) | switch         | \_Complex (C11)       |
| default     | int          | typedef        | \_Generic (C11)       |
| do          | long         | union          | \_Imaginary (C11)     |
| double      | register     | unsigned       | \_Noreturn (C11)      |
| else        | restrict     | void (C90)     | \_Static_assert (C11) |
| enum (C90)  | return       | volatile (C90) | \_Thread_local (C11)  |

如果使用关键字不当（如，用关键字作为变量名），编译器会将其视为语法错误。还有一些**保留标识符**（reserved identifier），C 语言已经指定了它们的用途或保留它们的使用权，如果你使用这些标识符来表示其他意思会导致一些问题。因此，尽管它们也是有效的名称，不会引起语法错误，也不能随便使用。<mark>保留标识符包括那些以下划线字符开头的标识符和标准库函数名，如 printf()</mark>。

## 2.9 关键概念

在本章中，读者的目标应该是理解什么是 C 程序。**可以把程序看作是你希望计算机如何完成任务的描述**。编译器负责处理一些细节工作，例如把你要计算机完成的任务转换成底层的机器语言（如果从量化方面来解释编译器所做的工作，它可以把 1KB 的源文件创建成 60KB 的可执行文件；即使是一个很简单的 C 程序也要用大量的机器语言来表示）。由于编译器不具有真正的智能，所以你必须用编译器能理解的术语表达你的意图，这些术语就是 C 语言标准规定的形式规则（尽管有些约束，但总比直接用机器语言方便得多）。

编译器希望接收到特定格式的指令。作为程序员的任务是，**在符合 C 标准的编译器框架中，表达你希望程序应该如何完成任务的想法**。

## 2.10 本章小结

C 程序由一个或多个 C 函数组成。每个 C 程序必须包含一个 `main()` 函数，这是 C 程序要调用的第 1 个函数。简单的函数由函数头和后面的一对花括号组成，花括号中是由声明、语句组成的函数体。

在 C 语言中，大部分语句都以分号结尾。声明为变量创建变量名和标识该变量中储存的数据类型。变量名是一种标识符。赋值表达式语句把值赋给变量，或者更一般地说，把值赋给存储空间。函数表达式语句用于调用指定的已命名函数。调用函数执行完毕后，程序会返回到函数调用后面的语句继续执行。

`printf()` 函数用于输出想要表达的内容和变量的值。

一门语言的语法是一套规则，用于管理语言中各有效语句组合在一起的方式。语句的语义是语句要表达的意思。编译器可以检测出语法错误，但是程序里的语义错误只有在编译完之后才能从程序的行为中表现出来。检查程序是否有语义错误要跟踪程序的状态，即程序每执行一步后所有变量的值。

最后，**关键字**是 C 语言的词汇。
